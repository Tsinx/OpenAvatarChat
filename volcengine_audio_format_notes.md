# 火山引擎音频格式配置记录

## 概述
本文档记录了火山引擎实时语音处理中的音频格式配置参数，用于避免音频播放杂音和格式不匹配问题。

## 火山引擎官方音频格式规范

### ASR (语音识别) - 客户端上传格式
- **格式**: PCM
- **声道**: 单声道 (1 channel)
- **采样率**: 16000 Hz
- **位深**: 16 bit (int16)
- **字节序**: 小端序 (Little Endian)

### TTS (语音合成) - 服务端返回格式
火山引擎TTS支持两种返回格式：

#### 格式1 (推荐使用)
- **声道**: 单声道 (1 channel)
- **采样率**: 24000 Hz
- **位深**: 32 bit
- **字节序**: 小端序 (Little Endian)
- **数据类型**: float32

#### 格式2 (备选)
- **声道**: 单声道 (1 channel)
- **采样率**: 24000 Hz
- **位深**: 16 bit
- **字节序**: 小端序 (Little Endian)
- **数据类型**: int16

## play_pcm_audio.py 配置参数

### 完美配置 (第83行)
```python
{'sample_rate': 24000, 'channels': 1, 'sample_width': 4, 'format_type': 'float32'}  # 32bit位深
```

### 参数说明
- `sample_rate: 24000` - 采样率24000Hz，匹配火山引擎TTS输出
- `channels: 1` - 单声道，符合官方规范
- `sample_width: 4` - 4字节 = 32位位深
- `format_type: 'float32'` - 32位浮点数格式，小端序

## 常见问题与解决方案

### 问题1: 播放时出现尖锐杂音
**原因**: 位深不匹配，使用了错误的音频参数
**解决**: 使用正确的32位float32格式参数

### 问题2: 音频失真或音量异常
**原因**: 字节序不匹配或采样率错误
**解决**: 确保使用小端序和正确的24000Hz采样率

### 问题3: 无法识别音频内容
**原因**: 声道数配置错误
**解决**: 使用单声道配置

## 字节序说明

### 小端序 (Little Endian)
- 最低有效字节存储在最低地址
- x86/x64平台默认使用小端序
- 火山引擎API使用小端序

### 示例
32位数据 `0x12345678` 在小端序中的存储：
```
地址: 0x00  0x01  0x02  0x03
数据: 0x78  0x56  0x34  0x12
```

## 测试验证

使用以下命令测试PCM文件播放：
```bash
python play_pcm_audio.py output.pcm
```

选择参数组合1 (24000Hz, 1声道, 32位) 应该能够完美播放火山引擎TTS生成的音频。

## 注意事项

1. **必须使用正确的位深**: 32位TTS输出不能用16位参数播放
2. **字节序很重要**: 错误的字节序会导致严重的音频失真
3. **采样率匹配**: 24000Hz是火山引擎TTS的标准输出采样率
4. **单声道配置**: 火山引擎音频均为单声道格式

---

**创建时间**: 2025年1月
**最后更新**: 解决PCM音频播放杂音问题
**状态**: 已验证可用